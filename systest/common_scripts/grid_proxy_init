load "gfarm_v2::get_hostids"

#
# Usage: grid_proxy_init [HOSTID...]
#
# Execute 'grid-proxy-init' on the specified hosts.
#
grid_proxy_init()
{
	for I in @ "$@"; do
		[ "X$I" = X@ ] && continue
		AUTH_TYPE=`eval echo \\$$I\_AUTH_TYPE`
		log_debug "grid_proxy_init: auth type of $I is '$AUTH_TYPE'"

		[ "X$AUTH_TYPE" != Xgsi -a "X$AUTH_TYPE" != Xgsi_auth ] \
			&& continue

		$GFSERVICE grid-proxy-init $I
		if [ $? -ne 0 ]; then
			log_warn "grid-proxy-init on $I failed"
			return 1
		fi
		log_debug "grid-proxy-init on $I done"
	done

	return 0
}

#
# Usage: grid_proxy_init_all
#
# Execute 'grid-proxy-init' on all defined hosts.
#
grid_proxy_init_all()
{
	return grid_proxy_init `get_all_hostids`
}

