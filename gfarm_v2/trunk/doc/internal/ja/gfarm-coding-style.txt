SRA の関与しているソースコードの構成は、下記のようになっています。

	makes/
		make に利用している仕組み

	ns/
		ninf service 関係のライブラリ、サーバー、クライアント。
		gfarm-1.0 では、このディレクトリ以下はリリース内容に
		含めず。

	include/gfarm および ns/include/gfarm/
	 → 生成物 ${prefix}/include/gfarm/*.h
		gfarm ライブラリのユーザー (例えば 森田さん) への
		公開ヘッダ

	lib/libgfarm/ → 生成物 ${prefix}/lib/libgfarm.a
		gfarm ライブラリ
		ユーザーへ公開しない関数の prototype 宣言は、
		こちらのディレクトリ以下の *.h にある。こちらのヘッダ
		はインストールされない。

		gfutil/
			gfarm と GFSL の双方から利用される部分を
			切り出したもの。
				libgfarm/gfsl  → libgfarm/gfutil
				libgfarm/gfarm → libgfarm/gfsl
				libgfarm/gfarm → libgfarm/gfutil
			という依存関係になる。

		gfsl/
			GFSL - GFarm Security Layer。
			globus の security layer である GSI との glue。
			m-hirano@sra.co.jp 作成。
			/usr/prj/etl/doc/GFSL/ 参照。
			かつては、${prefix}/lib/libgfsl.a という独立した
			ライブラリだった。

		gfarm/
			gfarm ライブラリの本体

	lib/gfs_hook/ → 生成物 ${prefix}/lib/{gfs_hook.o,gfs_hook_debug.o}
		open(2) や read(2), write(2) など、UNIX 標準の
		関数を置き換え、"gfarm:××" というファイルへの
		アクセスは、gfarm ライブラリへの呼びだしに変更
		する仕組み。
		
	server/gfmd/ → 生成物 ${prefix}/sbin/gfmd
		メタデータ・サーバー (になる予定のプログラム)
		現在のところ、job 管理しかしていない。
		現在のところ、gfarmlib は、gfmd を経由せず直接
		LDAP サーバー (slapd) にメタデータを問い合わせている。

	server/gfsd/ → 生成物 ${prefix}/sbin/gfsd
		各ノードで動作し、遠隔ファイルアクセスを提供する
		サーバー。
		現在のところ、メタデータへのアクセスはできない。
		(将来、できるようにする予定)

	gftools/ → ${prefix}/bin/*
		gfarm 関係の各種コマンド
		詳しくは man1, man8 参照

	gftools/example/ → ${prefix}/bin/* (かつては ${prefix}/bin/example/*)
		gfarm 関係のサンプル・ソース
		詳しくは man1, man8 参照

	gfptools/ → ${prefix}/bin/*
		gfarm スプール (gfarm:...) にインストールされるバイナリ

	bench/ → ${prefix}/bin/* (デフォールトでは生成しない)
		gfarm で利用しているベンチマーク・プログラム

	doc/ → 生成物 ${prefix}/share/doc/

		doc/docbook/{en,ja}/ref/ → インストールされない
			ほとんどの man page と HTML ファイルは、ここに
			ある DocBook 形式の SGML ファイルから自動生成
			されている。
			変更手順は、下記の通り。
			このうち 2〜4 は、Redhat-8.0 のマシン
			(例えば cvs.apgrid.org) 上で行うこと。
			必要なツールが揃っていれば Redhat-8.0 以外の
			OS でも 2〜3 を実行可能だが、動作確認してある
			のが Redhat-8.0 だけなので。
			1. doc/docbook/{en,ja}/ref/ の下を修正、コミット
			2. "make man" を実行し、man page を再生成する。
			3. "make html" を実行し、html ファイルを再生成する。
			4. man page と html ファイルをコミット

		doc/html/{en,ja}/ref/ → 生成物 ${prefix}/share/doc/html/
			ここにあるファイルは、ほとんど全て
			doc/docbook/{en,ja}/ref/ から生成されている。
			従って、マニュアルの更新は、直接ここを変更する
			のではなく、doc/docbook/{en,ja}/ref/ を変更する
			必要がある。
			doc/docbook/{en,ja}/ref/ を参照。

	man/ → 生成物 ${prefix}/man/
		ここにあるファイルは、ほとんど全て
		doc/docbook/{en,ja}/ref/ から生成されている。
		従って、マニュアルの更新は、直接ここを変更する
		のではなく、doc/docbook/{en,ja}/ref/ を変更する
		必要がある。
		doc/docbook/{en,ja}/ref/ を参照。

命名規約について
	ライブラリ中の公開されているシンボルは、必ず gfarm_ のような
	プリフィックスをつけ、ユーザー・アプリケーションのシンボルと
	重ならないようにしています。

エラーコードについて

	ほぼ全ての関数は、戻り値としてエラーコードを返します。
	エラーコードは、すべて表示可能な文字列 (char *) です。
	(本当は const char * へ変更すべきですが...)

	エラーコードとして数字ではなく文字列を返している理由は、
	ある種の手抜きです。
	gfarm 内部で定義しているエラーコードはともかく、他の
	サブシステム (UNIX, OpenLDAP, Globus, OpenSSL, ...) を
	呼び出している場合、そのサブシステムの返す可能性のある
	エラーコード全てについて、gfarm 自身のエラーコードを
	unique に定義する必要があります。(さもないと、サブ
	システムの定義する複数のエラーコードが、gfarm の
	単一つのエラーコードに変換されてしまって、エラー原因が
	わからなくなる)
	これをいちいち変換するのが面倒だったので、エラー文字列
	自身をエラーコードとして利用することにしました。
	(この結果、サブシステムのエラー文字列が、変換されずに
	 そのまま返ります。)

	なお、gfarm 内部で、正式に扱うエラーコードには、
	固定アドレスが割り当ててあり、
		e == GFARM_ERR_NO_SUCH_OBJECT
	のように、アドレス比較だけで、エラーの種類が判別できる
	ようにしてあります。	

各ソース・ファイルは、下記のような機能分担になっています。

ChangeLog	変更ログ。gfarm-cvs@apgrid.org に流れたメールを元に、
		建部さんが時々生成。
INSTALL.en	インストール・ドキュメント 英語版
INSTALL.ja	インストール・ドキュメント 日本語版

Makefile.in		Makefile のテンプレート
			configure コマンドを実行すると、これを元に
			Makefile を作成する。
acconfig.h		include/gfarm/gfarm_config.h.in のテンプレート
config.guess		autoconf パッケージの一部。
			configure が呼び出すサブ・コマンド。
config.sub		autoconf パッケージの一部。
			configure が呼び出すサブ・コマンド。
configure.in		configure スクリプトのソースコード
configure		autoconf コマンドを実行すると、
			configure.in を元に自動生成される。
include/gfarm/gfarm_config.h.in
			gfarm_config.h のテンプレート
			autoheader コマンドを実行すると、
			acconfig.h と configure.in を元に自動生成される。
install-sh		インストールコマンド

makes/
	config.mk.in	config.mk のテンプレート
			configure コマンドを実行すると、これを元に
			config.mk を作成する。
			通常の Makefile は、var.mk 経由で、間接的に
			config.mk を読み込む。
	man.mk		man ディレクトリ用の共通 Makefile
	prog.mk		プログラム・ディレクトリ用の共通 Makefile
	subdir.mk	サブディレクトリに対して make を呼び出す場合用の
			共通 Makefile
	var.mk		各 Makefile に共通する make 変数設定
			各 Makefile は下記の行を含む。
				include $(top_srcdir)/makes/var.mk

include/gfarm/
	ここの Makefile は、下記の形式で読み込む。
		#include <gfarm/なんとか.h>

	gfarm_error.h	エラーコード定義
	gfarm_metadb.h	meta databae アクセス
	gfs.h		gfarm ファイルアクセス
	gfarm_misc.h	その他もろもろ
	gfarm.h		上記すべてのヘッダおよび <gfarm/gfarm_config.h> を
			まとめて読み込む

lib/Makefile

lib/libgfarm/gfutil/
	hash.h		ハッシュ関数
	hash.c

	gfevent.h	並列アクセス用 select()/poll() wrapper
	gfevent.c

	gfutil.h	
	logutil.c	デーモン用ログ関数
	daemon.c	deamon(3) ユーティリティ関数。デーモン用。
	limit.c		limit 関係 ユーティリティ関数。デーモンから呼ばれる。

lib/libgfarm/gfarm/

	Makefile.in

	error.c		<gfarm/gfarm_error.h> のエラーコード定義

	iobuffer.h	入出力用 fifo バッファ。xxx_proto の下請けだが、
			xxx_proto の利用者から直接呼びだされることもある。
	iobuffer.c
			
	xxx_proto.h	通信、RPC において XDR に相当する処理
	xxx_proto.c
	io_fd.h		xxx_proto の下請け。file descriptor 経由の I/O を提供
	io_fd.c
	io_gfsl.c	xxx_proto の下請け。GFSL 経由の I/O を提供
	io_gfsl.h

	hostspec.h	設定ファイル中のホスト・ネットワーク・アドレス処理
	hostspec.c
	param.h		設定ファイル中の netparam オプション処理
	param.c
	sockopt.c	設定ファイル中の sockopt オプション処理
	sockopt.h
	config.c	設定ファイル読み込み

	host.h		host のアドレス解決等
	host.c
		host.h の canonical_hostname に関する処理は、メタデータへの
		アクセスがあるので、注意が必要。
		それらについては、gfs_client および gfsd/gfmd からは
		呼び出せない。

	auth.h		認証ライブラリ
	auth_common.c	認証用の共通関数
	auth_client.c		認証、クライアント側
	auth_client_gsi.c	GFSL/GSI 認証、クライアント側
	auth_server.c		認証、サーバー側
	auth_server_gsi.c	GFSL/GSI 認証、サーバー側
	auth_config.c		認証に関する設定ファイルの処理

	gfm_proto.h	gfmd プロトコル定義
	gfj_client.h	gfmd のジョブ管理関係 RPC 関数定義
	gfm_client.c	gfmd クライアント側 RPC stub

	gfs_proto.h	gfsd プロトコル定義
	gfs_proto.c	gfs プロトコル共通関数
	gfs_client.h	gfs クライアント側 RPC 関数定義
	gfs_client.c	gfs クライアント側 RPC stub
	gfs_client は、gfsd から呼ばれるため、現在のところ、
			メタデータアクセスを行なうことができない。

	gfs_pio.h	<gfarm/gfs.h> で定義された gfarm ファイルアクセス
	gfs_pio.c	主ルーチン
	gfs_pio_local.c		local file store へのアクセス処理
	gfs_pio_remote.c	remote file store (gfsd) へのアクセス処理
	gfs_pio_default.c	default view に関する処理
	gfs_pio_global.c	global view に関する処理
	gfs_pio_section.c	index view, section view に関する処理 
	gfs_pio_misc.c		gfs_pio_*() 以外の <gfarm/gfs.h> 関数

	import_help.c	gfimport_{text,fixed} 等へのヘルパ関数
	metadb_ldap.c	LDAP アクセス処理。<gfarm/gfarm_metadb.h> の実装
	metadb_misc.c	metadb 関係のいろいろな処理
	schedule.c	レプリカや計算ノードへのアクセスのスケジューリング
	stringlist.c	文字列リスト
	url.c		gfarm ファイル名の処理

lib/gfs_hook/
	Makefile.in
	hooks.c		gfs_hook の主処理
	hooks_64.c	64bit API に関する gfs_hook
	hooks_common.c	hooks.c と hooks_64.c の両方から#includeされる
	hooks_subr.h	gfs_hook 関係のサブルーチン
	hooks_subr.c	
	sysdep/linux/	gfs_hook の Linux 依存部

server/gfsd/
	Makefile
	loadavg.c	ロード・アベレージを得る OS 依存処理	
	gfsd.c		gfsd のメイン・プログラム

server/gfmd/
	Makefile
	gfmd.c		gfmd のメイン・プログラム。現在はジョブ管理のみ。

bench/
	Makefile
	bwlat-syscache/bwlat-syscache.c
	nconnect/nconnect.c
	thput-fsys/thput-fsys.c
	thput-gfpio/thput-gfpio.c
	thput-pvfs/thput-pvfs.c
	thput-fsstripe/thput-fsstripe.c

package/
	redhat/

	solaris/

debian/

TODO
	- lib/libgfarm/gfarm/xxx_proto.{h,c}
		Ninf RPC 用 XDR (ns/nslib/soc-lxdr.c, ns/nslib/com.c) 
		との統合をすべき。
		名前が現在 xxx_ なのは、本来は ns_ (ninf) に変更すべきだから。

コーディング・スタイルは、おおよそ NetBSD KNF (kernel normal form) に
従っています。
NetBSD KNF:
http://cvsweb.netbsd.org/bsdweb.cgi/sharesrc/share/misc/style?rev=HEAD&content-type=text/x-cvsweb-markup

ヘッダファイルの #include を記述する順序の原則は、下記の通りです。

- OS付属のヘッダファイル群

- サードパーティー製のソフトウェアのヘッダファイル群
	複数のサードパーティー製ソフトウェアを利用している場合、
	・サードパーティー製ソフトウェア間に参照関係がある場合には、
	  参照される側(ソフトウェア階層として下に位置する方)のソフトウェアを
	  先に書く。
	  参照する側(ソフトウェア階層として上に位置する方)のソフトウェアを
	  後に書く。
	・同一のソフトウェアに付属するヘッダは、まとめて書く。

- gfarm の公開ヘッダ (<gfarm/××.h>)

- gfarm の非公開ヘッダ ("××.h")
	・ヘッダ間の順序は、
	  参照される側(ソフトウェア階層として下に位置する方)のソフトウェアを
	  先に書く。
	  参照する側(ソフトウェア階層として上に位置する方)のソフトウェアを
	  後に書く。
	・libgfarm/gfutil, libgfarm/gfsl, libgfarm/gfarm の三者については、
	  同一のディレクトリに所属するヘッダはまとめて書く。
	  #include する順序は、
		1. libgfarm/gfutil
		2. libgfarm/gfsl
		3. libgfarm/gfarm
	  の順番とする。(ソフトウェア階層が、この順で下→上となっているため)
	・具体的には下記の通り。
	  /* gfutil */
		#include "hash.h"
		#include "gfevent.h"
		#include "gfutil.h"
	  /* gfsl public */
		#include "gfsl_config.h"
		#include "gfarm_gsi.h"
		#include "gfarm_auth.h"
		#include "gfarm_secure_session.h"
	  /* gfsl private */
		#include "tcputil.h"
		#include "misc.h"
	  /* gfarm */
		#include "iobuffer.h"
		#include "xxx_proto.h"
		#include "io_fd.h"
		#include "io_gfsl.h"

		#include "hostspec.h"
		#include "host.h"
		#include "param.h"
		#include "sockopt.h"

		#include "auth.h"
		#include "auth_gsi.h"

		#include "config.h"

		#include "gfm_proto.h"
		#include "gfs_proto.h"
		#include "gfs_client.h"
		#include "gfj_client.h"

		#include "gfs_pio.h"
